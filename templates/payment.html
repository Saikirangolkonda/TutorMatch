<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - TutorMatch</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; }
        
        .header { background: linear-gradient(135deg, #15c249 0%, #15c249 100%); color: white; padding: 1rem 0; }
        .nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .logo { font-size: 1.8rem; font-weight: bold; }
        .nav-links a { color: white; text-decoration: none; margin-left: 20px; opacity: 0.9; }
        
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .payment-header { text-align: center; margin-bottom: 30px; }
        .payment-header h1 { color: #2c3e50; font-size: 2rem; margin-bottom: 10px; }
        
        .payment-layout { display: grid; grid-template-columns: 1fr 300px; gap: 30px; }
        .payment-form { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .order-summary { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); height: fit-content; }
        
        .form-section { margin-bottom: 30px; }
        .form-section h3 { color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #2c3e50; font-weight: 600; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        
        .form-row { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; }
        .payment-methods { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .payment-method { border: 2px solid #e1e8ed; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .payment-method:hover { border-color: #667eea; }
        .payment-method.selected { border-color: #667eea; background: #f8f9ff; }
        .payment-method img { width: 40px; height: 25px; object-fit: contain; margin-bottom: 5px; }
        
        .security-info { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #27ae60; margin-bottom: 20px; }
        .security-info p { color: #666; font-size: 0.9rem; margin-bottom: 5px; }
        
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 5px 0; }
        .summary-total { border-top: 2px solid #f1f3f4; padding-top: 15px; margin-top: 15px; font-weight: bold; font-size: 1.2rem; }
        
        .btn { padding: 12px 25px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: transform 0.2s; width: 100%; font-weight: 600; }
        .btn:hover { transform: scale(1.02); }
        .btn-secondary { background: #95a5a6; }
        
        .booking-details { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .tutor-info { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .tutor-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #000000, #020b05); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        
        .confirmation-page { display: none; text-align: center; }
        .success-icon { width: 80px; height: 80px; background: #27ae60; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: white; font-size: 2rem; }
        .confirmation-details { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin: 20px 0; text-align: left; }
        
        @media (max-width: 768px) {
            .payment-layout { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .payment-methods { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">TutorMatch</div>
            <div class="nav-links">
                <a href="/tutor-search">Back to Search</a>
                <a href="/student-dashboard">Dashboard</a>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- Payment Page -->
        <div id="paymentPage">
            <div class="payment-header">
                <h1>Complete Your Payment</h1>
                <p style="color: #666;">Secure checkout for your tutoring session</p>
            </div>
            
            <form method="POST" action="/process-payment" id="paymentForm">
                <input type="hidden" name="booking_id" value="{{ booking_id }}">
                <input type="hidden" name="payment_method" id="selectedPaymentMethod" value="card">
                
                <div class="payment-layout">
                    <div class="payment-form">
                        <div class="form-section">
                            <h3>ðŸ’³ Payment Method</h3>
                            <div class="payment-methods">
                                <div class="payment-method selected" onclick="selectPaymentMethod(this, 'card')">
                                    <div style="font-size: 1.5rem; margin-bottom: 5px;">ðŸ’³</div>
                                    <div style="font-size: 0.9rem;">Credit Card</div>
                                </div>
                                <div class="payment-method" onclick="selectPaymentMethod(this, 'paypal')">
                                    <div style="font-size: 1.5rem; margin-bottom: 5px; color: #0070ba;">P</div>
                                    <div style="font-size: 0.9rem;">PayPal</div>
                                </div>
                                <div class="payment-method" onclick="selectPaymentMethod(this, 'apple')">
                                    <div style="font-size: 1.5rem; margin-bottom: 5px;"></div>
                                    <div style="font-size: 0.9rem;">Apple Pay</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section" id="cardForm">
                            <h3>ðŸ’³ Card Information</h3>
                            <div class="form-group">
                                <label>Card Number</label>
                                <input type="text" name="card_number" placeholder="1234 5678 9012 3456" maxlength="19" onInput="formatCardNumber(this)">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Expiry Date</label>
                                    <input type="text" name="expiry" placeholder="MM/YY" maxlength="5" onInput="formatExpiry(this)">
                                </div>
                                <div class="form-group">
                                    <label>CVV</label>
                                    <input type="text" name="cvv" placeholder="123" maxlength="3">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Cardholder Name</label>
                                <input type="text" name="cardholder_name" placeholder="John Smith">
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>ðŸ“§ Contact Information</h3>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" name="email" placeholder="your@email.com" required>
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" name="phone" placeholder="+1 (555) 123-4567" required>
                            </div>
                        </div>

                        <div class="security-info">
                            <p>ðŸ”’ Your payment information is secure and encrypted</p>
                            <p>ðŸ“ž Free cancellation up to 24 hours before your session</p>
                            <p>ðŸ’° 100% money-back guarantee if not satisfied</p>
                        </div>

                        <button type="submit" class="btn">
                            Complete Payment - ${{ "%.2f"|format(booking.total_price + 2) }}
                        </button>
                    </div>

                    <div class="order-summary">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">ðŸ“‹ Order Summary</h3>
                        
                        <div class="booking-details">
                            <div class="tutor-info">
                                <div class="tutor-avatar">{{ booking.tutor_data.avatar or booking.tutor_data.name[:2].upper() }}</div>
                                <div>
                                    <div style="font-weight: 600;">{{ booking.tutor_data.name }}</div>
                                    <div style="color: #666; font-size: 0.9rem;">
                                        {% if booking.tutor_data.subjects %}
                                            {{ booking.tutor_data.subjects|join(', ') }}
                                        {% else %}
                                            Subject Tutor
                                        {% endif %}
                                    </div>
                                    <div style="color: #f39c12; font-size: 0.9rem;">
                                        â˜…â˜…â˜…â˜…â˜… ({{ booking.tutor_data.rating }})
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <p><strong>Date:</strong> {{ booking.date }}</p>
                                <p><strong>Time:</strong> {{ booking.time }}</p>
                                <p><strong>Subject:</strong> {{ booking.subject }}</p>
                                <p><strong>Format:</strong> {{ booking.session_format }}</p>
                            </div>
                        </div>

                        <div class="summary-item">
                            <span>Session Type:</span>
                            <span>{{ booking.session_type }}</span>
                        </div>
                        <div class="summary-item">
                            <span>Sessions Count:</span>
                            <span>{{ booking.sessions_count }}</span>
                        </div>
                        <div class="summary-item">
                            <span>Rate:</span>
                            <span>${{ booking.tutor_data.rate }}/hour</span>
                        </div>
                        <div class="summary-item">
                            <span>Subtotal:</span>
                            <span>${{ "%.2f"|format(booking.total_price) }}</span>
                        </div>
                        <div class="summary-item">
                            <span>Platform Fee:</span>
                            <span>$2.00</span>
                        </div>
                        
                        <div class="summary-total">
                            <div class="summary-item">
                                <span>Total:</span>
                                <span>${{ "%.2f"|format(booking.total_price + 2) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        function selectPaymentMethod(element, method) {
            document.querySelectorAll('.payment-method').forEach(pm => pm.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById('selectedPaymentMethod').value = method;
            
            // Show/hide card form based on payment method
            const cardForm = document.getElementById('cardForm');
            if (method === 'card') {
                cardForm.style.display = 'block';
            } else {
                cardForm.style.display = 'none';
            }
        }

        function formatCardNumber(input) {
            let value = input.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            input.value = formattedValue;
        }

        function formatExpiry(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            input.value = value;
        }

        // Form validation
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            const paymentMethod = document.getElementById('selectedPaymentMethod').value;
            
            if (paymentMethod === 'card') {
                const cardNumber = document.querySelector('input[name="card_number"]').value;
                const cardholder = document.querySelector('input[name="cardholder_name"]').value;
                const expiry = document.querySelector('input[name="expiry"]').value;
                const cvv = document.querySelector('input[name="cvv"]').value;
                
                if (!cardNumber || !cardholder || !expiry || !cvv) {
                    e.preventDefault();
                    alert('Please fill in all card details.');
                    return false;
                }
            }
        });
    </script>
</body>
</html>